/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks
package frontpage
package order_item

import adventureworks.customtypes.Defaulted
import adventureworks.customtypes.TypoLocalDateTime
import adventureworks.frontpage.order.OrderId
import adventureworks.frontpage.product.ProductId
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** This class corresponds to a row in table `frontpage.order_item` which has not been persisted yet */
case class OrderItemRowUnsaved(
  /** Points to [[order.OrderRow.id]] */
  orderId: Option[OrderId],
  /** Points to [[product.ProductRow.id]] */
  productId: Option[ProductId],
  quantity: Int,
  price: BigDecimal,
  shippedAt: Option[TypoLocalDateTime],
  /** Default: gen_random_uuid() */
  id: Defaulted[OrderItemId] = Defaulted.UseDefault
) {
  def toRow(idDefault: => OrderItemId): OrderItemRow =
    OrderItemRow(
      orderId = orderId,
      productId = productId,
      quantity = quantity,
      price = price,
      shippedAt = shippedAt,
      id = id match {
             case Defaulted.UseDefault => idDefault
             case Defaulted.Provided(value) => value
           }
    )
}
object OrderItemRowUnsaved {
  implicit lazy val reads: Reads[OrderItemRowUnsaved] = Reads[OrderItemRowUnsaved](json => JsResult.fromTry(
      Try(
        OrderItemRowUnsaved(
          orderId = json.\("order_id").toOption.map(_.as(OrderId.reads)),
          productId = json.\("product_id").toOption.map(_.as(ProductId.reads)),
          quantity = json.\("quantity").as(Reads.IntReads),
          price = json.\("price").as(Reads.bigDecReads),
          shippedAt = json.\("shipped_at").toOption.map(_.as(TypoLocalDateTime.reads)),
          id = json.\("id").as(Defaulted.reads(OrderItemId.reads))
        )
      )
    ),
  )
  implicit lazy val text: Text[OrderItemRowUnsaved] = Text.instance[OrderItemRowUnsaved]{ (row, sb) =>
    Text.option(OrderId.text).unsafeEncode(row.orderId, sb)
    sb.append(Text.DELIMETER)
    Text.option(ProductId.text).unsafeEncode(row.productId, sb)
    sb.append(Text.DELIMETER)
    Text.intInstance.unsafeEncode(row.quantity, sb)
    sb.append(Text.DELIMETER)
    Text.bigDecimalInstance.unsafeEncode(row.price, sb)
    sb.append(Text.DELIMETER)
    Text.option(TypoLocalDateTime.text).unsafeEncode(row.shippedAt, sb)
    sb.append(Text.DELIMETER)
    Defaulted.text(OrderItemId.text).unsafeEncode(row.id, sb)
  }
  implicit lazy val writes: OWrites[OrderItemRowUnsaved] = OWrites[OrderItemRowUnsaved](o =>
    new JsObject(ListMap[String, JsValue](
      "order_id" -> Writes.OptionWrites(OrderId.writes).writes(o.orderId),
      "product_id" -> Writes.OptionWrites(ProductId.writes).writes(o.productId),
      "quantity" -> Writes.IntWrites.writes(o.quantity),
      "price" -> Writes.BigDecimalWrites.writes(o.price),
      "shipped_at" -> Writes.OptionWrites(TypoLocalDateTime.writes).writes(o.shippedAt),
      "id" -> Defaulted.writes(OrderItemId.writes).writes(o.id)
    ))
  )
}
