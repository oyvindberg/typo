/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks
package pg_catalog
package pg_attribute

import adventureworks.customtypes.TypoAclItem
import adventureworks.customtypes.TypoAnyArray
import adventureworks.customtypes.TypoShort
import typo.dsl.DeleteBuilder
import typo.dsl.SelectBuilder
import typo.dsl.SelectBuilderSql
import typo.dsl.UpdateBuilder
import zio.ZIO
import zio.jdbc.SqlFragment.Segment
import zio.jdbc.SqlFragment.Setter
import zio.jdbc.UpdateResult
import zio.jdbc.ZConnection
import zio.jdbc.sqlInterpolator
import zio.stream.ZStream

object PgAttributeRepoImpl extends PgAttributeRepo {
  override def delete(compositeId: PgAttributeId): ZIO[ZConnection, Throwable, Boolean] = {
    sql"""delete from pg_catalog.pg_attribute where "attrelid" = ${Segment.paramSegment(compositeId.attrelid)(Setter.longSetter)} AND "attnum" = ${Segment.paramSegment(compositeId.attnum)(TypoShort.setter)}""".delete.map(_ > 0)
  }
  override def delete: DeleteBuilder[PgAttributeFields, PgAttributeRow] = {
    DeleteBuilder("pg_catalog.pg_attribute", PgAttributeFields)
  }
  override def insert(unsaved: PgAttributeRow): ZIO[ZConnection, Throwable, PgAttributeRow] = {
    sql"""insert into pg_catalog.pg_attribute("attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval")
          values (${Segment.paramSegment(unsaved.attrelid)(Setter.longSetter)}::oid, ${Segment.paramSegment(unsaved.attname)(Setter.stringSetter)}::name, ${Segment.paramSegment(unsaved.atttypid)(Setter.longSetter)}::oid, ${Segment.paramSegment(unsaved.attstattarget)(Setter.intSetter)}::int4, ${Segment.paramSegment(unsaved.attlen)(TypoShort.setter)}::int2, ${Segment.paramSegment(unsaved.attnum)(TypoShort.setter)}::int2, ${Segment.paramSegment(unsaved.attndims)(Setter.intSetter)}::int4, ${Segment.paramSegment(unsaved.attcacheoff)(Setter.intSetter)}::int4, ${Segment.paramSegment(unsaved.atttypmod)(Setter.intSetter)}::int4, ${Segment.paramSegment(unsaved.attbyval)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.attalign)(Setter.stringSetter)}::char, ${Segment.paramSegment(unsaved.attstorage)(Setter.stringSetter)}::char, ${Segment.paramSegment(unsaved.attcompression)(Setter.stringSetter)}::char, ${Segment.paramSegment(unsaved.attnotnull)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.atthasdef)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.atthasmissing)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.attidentity)(Setter.stringSetter)}::char, ${Segment.paramSegment(unsaved.attgenerated)(Setter.stringSetter)}::char, ${Segment.paramSegment(unsaved.attisdropped)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.attislocal)(Setter.booleanSetter)}, ${Segment.paramSegment(unsaved.attinhcount)(Setter.intSetter)}::int4, ${Segment.paramSegment(unsaved.attcollation)(Setter.longSetter)}::oid, ${Segment.paramSegment(unsaved.attacl)(Setter.optionParamSetter(TypoAclItem.arraySetter))}::_aclitem, ${Segment.paramSegment(unsaved.attoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text, ${Segment.paramSegment(unsaved.attfdwoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text, ${Segment.paramSegment(unsaved.attmissingval)(Setter.optionParamSetter(TypoAnyArray.setter))}::anyarray)
          returning "attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval"
       """.insertReturning(PgAttributeRow.jdbcDecoder).map(_.updatedKeys.head)
  }
  override def select: SelectBuilder[PgAttributeFields, PgAttributeRow] = {
    SelectBuilderSql("pg_catalog.pg_attribute", PgAttributeFields, PgAttributeRow.jdbcDecoder)
  }
  override def selectAll: ZStream[ZConnection, Throwable, PgAttributeRow] = {
    sql"""select "attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval" from pg_catalog.pg_attribute""".query(PgAttributeRow.jdbcDecoder).selectStream
  }
  override def selectById(compositeId: PgAttributeId): ZIO[ZConnection, Throwable, Option[PgAttributeRow]] = {
    sql"""select "attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval" from pg_catalog.pg_attribute where "attrelid" = ${Segment.paramSegment(compositeId.attrelid)(Setter.longSetter)} AND "attnum" = ${Segment.paramSegment(compositeId.attnum)(TypoShort.setter)}""".query(PgAttributeRow.jdbcDecoder).selectOne
  }
  override def selectByUnique(attrelid: /* oid */ Long, attname: String): ZIO[ZConnection, Throwable, Option[PgAttributeRow]] = {
    sql"""select "attrelid", "attname"
          from pg_catalog.pg_attribute
          where "attrelid" = ${Segment.paramSegment(attrelid)(Setter.longSetter)} AND "attname" = ${Segment.paramSegment(attname)(Setter.stringSetter)}
       """.query(PgAttributeRow.jdbcDecoder).selectOne
  }
  override def update(row: PgAttributeRow): ZIO[ZConnection, Throwable, Boolean] = {
    val compositeId = row.compositeId
    sql"""update pg_catalog.pg_attribute
          set "attname" = ${Segment.paramSegment(row.attname)(Setter.stringSetter)}::name,
              "atttypid" = ${Segment.paramSegment(row.atttypid)(Setter.longSetter)}::oid,
              "attstattarget" = ${Segment.paramSegment(row.attstattarget)(Setter.intSetter)}::int4,
              "attlen" = ${Segment.paramSegment(row.attlen)(TypoShort.setter)}::int2,
              "attndims" = ${Segment.paramSegment(row.attndims)(Setter.intSetter)}::int4,
              "attcacheoff" = ${Segment.paramSegment(row.attcacheoff)(Setter.intSetter)}::int4,
              "atttypmod" = ${Segment.paramSegment(row.atttypmod)(Setter.intSetter)}::int4,
              "attbyval" = ${Segment.paramSegment(row.attbyval)(Setter.booleanSetter)},
              "attalign" = ${Segment.paramSegment(row.attalign)(Setter.stringSetter)}::char,
              "attstorage" = ${Segment.paramSegment(row.attstorage)(Setter.stringSetter)}::char,
              "attcompression" = ${Segment.paramSegment(row.attcompression)(Setter.stringSetter)}::char,
              "attnotnull" = ${Segment.paramSegment(row.attnotnull)(Setter.booleanSetter)},
              "atthasdef" = ${Segment.paramSegment(row.atthasdef)(Setter.booleanSetter)},
              "atthasmissing" = ${Segment.paramSegment(row.atthasmissing)(Setter.booleanSetter)},
              "attidentity" = ${Segment.paramSegment(row.attidentity)(Setter.stringSetter)}::char,
              "attgenerated" = ${Segment.paramSegment(row.attgenerated)(Setter.stringSetter)}::char,
              "attisdropped" = ${Segment.paramSegment(row.attisdropped)(Setter.booleanSetter)},
              "attislocal" = ${Segment.paramSegment(row.attislocal)(Setter.booleanSetter)},
              "attinhcount" = ${Segment.paramSegment(row.attinhcount)(Setter.intSetter)}::int4,
              "attcollation" = ${Segment.paramSegment(row.attcollation)(Setter.longSetter)}::oid,
              "attacl" = ${Segment.paramSegment(row.attacl)(Setter.optionParamSetter(TypoAclItem.arraySetter))}::_aclitem,
              "attoptions" = ${Segment.paramSegment(row.attoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text,
              "attfdwoptions" = ${Segment.paramSegment(row.attfdwoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text,
              "attmissingval" = ${Segment.paramSegment(row.attmissingval)(Setter.optionParamSetter(TypoAnyArray.setter))}::anyarray
          where "attrelid" = ${Segment.paramSegment(compositeId.attrelid)(Setter.longSetter)} AND "attnum" = ${Segment.paramSegment(compositeId.attnum)(TypoShort.setter)}""".update.map(_ > 0)
  }
  override def update: UpdateBuilder[PgAttributeFields, PgAttributeRow] = {
    UpdateBuilder("pg_catalog.pg_attribute", PgAttributeFields, PgAttributeRow.jdbcDecoder)
  }
  override def upsert(unsaved: PgAttributeRow): ZIO[ZConnection, Throwable, UpdateResult[PgAttributeRow]] = {
    sql"""insert into pg_catalog.pg_attribute("attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval")
          values (
            ${Segment.paramSegment(unsaved.attrelid)(Setter.longSetter)}::oid,
            ${Segment.paramSegment(unsaved.attname)(Setter.stringSetter)}::name,
            ${Segment.paramSegment(unsaved.atttypid)(Setter.longSetter)}::oid,
            ${Segment.paramSegment(unsaved.attstattarget)(Setter.intSetter)}::int4,
            ${Segment.paramSegment(unsaved.attlen)(TypoShort.setter)}::int2,
            ${Segment.paramSegment(unsaved.attnum)(TypoShort.setter)}::int2,
            ${Segment.paramSegment(unsaved.attndims)(Setter.intSetter)}::int4,
            ${Segment.paramSegment(unsaved.attcacheoff)(Setter.intSetter)}::int4,
            ${Segment.paramSegment(unsaved.atttypmod)(Setter.intSetter)}::int4,
            ${Segment.paramSegment(unsaved.attbyval)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.attalign)(Setter.stringSetter)}::char,
            ${Segment.paramSegment(unsaved.attstorage)(Setter.stringSetter)}::char,
            ${Segment.paramSegment(unsaved.attcompression)(Setter.stringSetter)}::char,
            ${Segment.paramSegment(unsaved.attnotnull)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.atthasdef)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.atthasmissing)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.attidentity)(Setter.stringSetter)}::char,
            ${Segment.paramSegment(unsaved.attgenerated)(Setter.stringSetter)}::char,
            ${Segment.paramSegment(unsaved.attisdropped)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.attislocal)(Setter.booleanSetter)},
            ${Segment.paramSegment(unsaved.attinhcount)(Setter.intSetter)}::int4,
            ${Segment.paramSegment(unsaved.attcollation)(Setter.longSetter)}::oid,
            ${Segment.paramSegment(unsaved.attacl)(Setter.optionParamSetter(TypoAclItem.arraySetter))}::_aclitem,
            ${Segment.paramSegment(unsaved.attoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text,
            ${Segment.paramSegment(unsaved.attfdwoptions)(Setter.optionParamSetter(adventureworks.StringArraySetter))}::_text,
            ${Segment.paramSegment(unsaved.attmissingval)(Setter.optionParamSetter(TypoAnyArray.setter))}::anyarray
          )
          on conflict ("attrelid", "attnum")
          do update set
            "attname" = EXCLUDED."attname",
            "atttypid" = EXCLUDED."atttypid",
            "attstattarget" = EXCLUDED."attstattarget",
            "attlen" = EXCLUDED."attlen",
            "attndims" = EXCLUDED."attndims",
            "attcacheoff" = EXCLUDED."attcacheoff",
            "atttypmod" = EXCLUDED."atttypmod",
            "attbyval" = EXCLUDED."attbyval",
            "attalign" = EXCLUDED."attalign",
            "attstorage" = EXCLUDED."attstorage",
            "attcompression" = EXCLUDED."attcompression",
            "attnotnull" = EXCLUDED."attnotnull",
            "atthasdef" = EXCLUDED."atthasdef",
            "atthasmissing" = EXCLUDED."atthasmissing",
            "attidentity" = EXCLUDED."attidentity",
            "attgenerated" = EXCLUDED."attgenerated",
            "attisdropped" = EXCLUDED."attisdropped",
            "attislocal" = EXCLUDED."attislocal",
            "attinhcount" = EXCLUDED."attinhcount",
            "attcollation" = EXCLUDED."attcollation",
            "attacl" = EXCLUDED."attacl",
            "attoptions" = EXCLUDED."attoptions",
            "attfdwoptions" = EXCLUDED."attfdwoptions",
            "attmissingval" = EXCLUDED."attmissingval"
          returning "attrelid", "attname", "atttypid", "attstattarget", "attlen", "attnum", "attndims", "attcacheoff", "atttypmod", "attbyval", "attalign", "attstorage", "attcompression", "attnotnull", "atthasdef", "atthasmissing", "attidentity", "attgenerated", "attisdropped", "attislocal", "attinhcount", "attcollation", "attacl", "attoptions", "attfdwoptions", "attmissingval"""".insertReturning(PgAttributeRow.jdbcDecoder)
  }
}
