/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.update_person_returning

import adventureworks.customtypes.TypoLocalDateTime
import zio.jdbc.SqlFragment.Segment
import zio.jdbc.SqlFragment.Setter
import zio.jdbc.ZConnection
import zio.jdbc.sqlInterpolator
import zio.stream.ZStream

class UpdatePersonReturningSqlRepoImpl extends UpdatePersonReturningSqlRepo {
  override def apply(suffix: /* nullability unknown */ Option[String], cutoff: /* nullability unknown */ Option[TypoLocalDateTime]): ZStream[ZConnection, Throwable, UpdatePersonReturningSqlRow] = {
    val sql =
      sql"""with row as (
              update person.person
              set firstname = firstname || '-' || ${Segment.paramSegment(suffix)(Setter.optionParamSetter(Setter.stringSetter))}
              where modifieddate < ${Segment.paramSegment(cutoff)(Setter.optionParamSetter(TypoLocalDateTime.setter))}::timestamp
              returning firstname, modifieddate
            )
            select row."firstname", row."modifieddate"::text
            from row"""
    sql.query(using UpdatePersonReturningSqlRow.jdbcDecoder).selectStream()
  }
}
