/**
 * File automatically generated by `typo` for its own test suite.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN
 */
package testdb
package hardcoded
package myschema
package marital_status

import typo.dsl.DeleteBuilder
import typo.dsl.SelectBuilder
import typo.dsl.SelectBuilderSql
import typo.dsl.UpdateBuilder
import zio.ZIO
import zio.jdbc.SqlFragment
import zio.jdbc.SqlFragment.Segment
import zio.jdbc.SqlFragment.Setter
import zio.jdbc.UpdateResult
import zio.jdbc.ZConnection
import zio.jdbc.sqlInterpolator
import zio.stream.ZStream

object MaritalStatusRepoImpl extends MaritalStatusRepo {
  override def delete(id: MaritalStatusId): ZIO[ZConnection, Throwable, Boolean] = {
    sql"""delete from myschema.marital_status where "id" = ${Segment.paramSegment(id)(Setter[MaritalStatusId])}""".delete.map(_ > 0)
  }
  override def delete: DeleteBuilder[MaritalStatusFields, MaritalStatusRow] = {
    DeleteBuilder("myschema.marital_status", MaritalStatusFields)
  }
  override def insert(unsaved: MaritalStatusRow): ZIO[ZConnection, Throwable, MaritalStatusRow] = {
    sql"""insert into myschema.marital_status("id")
          values (${Segment.paramSegment(unsaved.id)(Setter[MaritalStatusId])}::int8)
          returning "id"
       """.insertReturning(MaritalStatusRow.jdbcDecoder).map(_.updatedKeys.head)
  }
  override def select: SelectBuilder[MaritalStatusFields, MaritalStatusRow] = {
    SelectBuilderSql("myschema.marital_status", MaritalStatusFields, MaritalStatusRow.jdbcDecoder)
  }
  override def selectAll: ZStream[ZConnection, Throwable, MaritalStatusRow] = {
    sql"""select "id" from myschema.marital_status""".query(MaritalStatusRow.jdbcDecoder).selectStream
  }
  override def selectById(id: MaritalStatusId): ZIO[ZConnection, Throwable, Option[MaritalStatusRow]] = {
    sql"""select "id" from myschema.marital_status where "id" = ${Segment.paramSegment(id)(Setter[MaritalStatusId])}""".query(MaritalStatusRow.jdbcDecoder).selectOne
  }
  override def selectByIds(ids: Array[MaritalStatusId]): ZStream[ZConnection, Throwable, MaritalStatusRow] = {
    sql"""select "id" from myschema.marital_status where "id" = ANY(${Segment.paramSegment(ids)(MaritalStatusId.arraySetter)})""".query(MaritalStatusRow.jdbcDecoder).selectStream
  }
  override def selectByFieldValues(fieldValues: List[MaritalStatusFieldOrIdValue[?]]): ZStream[ZConnection, Throwable, MaritalStatusRow] = {
    fieldValues match {
      case Nil      => selectAll
      case nonEmpty =>
        val wheres = SqlFragment.empty.and(
          nonEmpty.map {
            case MaritalStatusFieldValue.id(value) => sql""""id" = ${Segment.paramSegment(value)(Setter[MaritalStatusId])}"""
          }
        )
        sql"""select "id" from myschema.marital_status where $wheres""".query(MaritalStatusRow.jdbcDecoder).selectStream
    }
  }
  override def update: UpdateBuilder[MaritalStatusFields, MaritalStatusRow] = {
    UpdateBuilder("myschema.marital_status", MaritalStatusFields, MaritalStatusRow.jdbcDecoder)
  }
  override def upsert(unsaved: MaritalStatusRow): ZIO[ZConnection, Throwable, UpdateResult[MaritalStatusRow]] = {
    sql"""insert into myschema.marital_status("id")
          values (
            ${Segment.paramSegment(unsaved.id)(Setter[MaritalStatusId])}::int8
          )
          on conflict ("id")
          returning "id"""".insertReturning(MaritalStatusRow.jdbcDecoder)
  }
}
